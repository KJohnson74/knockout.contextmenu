// knockout.contextmenu v0.1.0
// Nicol√°s Escalante - nlante@gmail.com
// License: MIT

!function(a){"use strict";function b(b,c){function d(){e&&e.parentNode&&e.parentNode.removeChild(e),e=null}var e,f=c.onclick,g=[];c.onclick=function(a){a.defaultPrevented||(f&&f(a),d())},b.bindingHandlers.contextMenu={getMenuFor:function(a,b){for(var c=0;c<g.length;c++)if(g[c].element===a)return g[c].get(b)},init:function(f,h,i,j){function k(a){var b=l(a).element;return d(),a&&(b.style.top=a.pageY,b.style.left=a.pageX,a.preventDefault()),(c.body||c).appendChild(b),e=b,b}function l(){function a(a){var b=m(a),c=[];b.isVisible&&(e=e||b.isBoolean,b.isChecked&&c.push("checked"),b.isDisabled&&c.push("disabled"),b.isSeparator&&c.push("separator"),b.url&&c.push("with-url"),f.push('<li class="'+c.join(" ")+'">'+b.html+"</li>"),g.push(b.action)),h.push(b)}var d,e=!1,f=[],g=[],h=[];for(var i in n)a(i);return f.length&&(d=c.createElement("div"),d.className=p,d.innerHTML='<ul class="'+(e?"has-checks":"")+'">'+f.join("")+"</ul>",f.forEach(function(a,c){b.utils.registerEventHandler(d.children[0].children[c],"click",function(a){var b=g[c](j,a);!b&&a&&a.preventDefault()})})),{element:d,items:h,open:k,hide:function(){d&&d.parentNode&&d.parentNode.removeChild(d)}}}function m(c){function d(a,d){var e=c+" option must have an action or an url.";if(m)return!1;if(b.isObservable(g)&&"boolean"==typeof g())g(!g());else if("object"==typeof g){if(!(g.action||h||o))throw e;g.action&&(b.isObservable(g.action)&&"boolean"==typeof g.action()?g.action(!g.action()):g.action(a,d))}else{if("function"!=typeof g)throw e;g(a,d)}return!0}var e="",f="",g=n[c]||{},h=b.isObservable(g.url)?g.url():g.url,i=g.visible===a||null===g.visible||b.isObservable(g.visible)&&g.visible()||!!g.visible,j=!1,k=!g.disabled||b.isObservable(g.disabled)&&!g.disabled()||b.isObservable(g.enabled)&&g.enabled()||!!g.enabled,l=!1,m=!k,o=!!n[c].separator;return o||(e=b.isObservable(g.text)?g.text():g.text,e||(e=c),f=h?'<a href="'+h+'">'+e+"</a>":e),(b.isObservable(g)&&"boolean"==typeof g()||b.isObservable(g.action)&&"boolean"==typeof g.action())&&(l=!0,(g.action&&g.action()||"function"==typeof g&&g())&&(j=!0)),{html:f,text:e,url:h,isVisible:i,isChecked:j,isEnabled:k,isDisabled:m,isBoolean:l,isSeparator:o,action:d}}var n=h()||{},o=i(),p=o.contextMenuClass||"context-menu";o.bindMenuOnClick&&b.utils.registerEventHandler(f,"click",k),(o.bindMenuOnContextMenu===a||o.bindMenuOnContextMenu)&&b.utils.registerEventHandler(f,"contextmenu",k),g.push({element:f,get:l})}}}typeof ko!=a+""&&typeof document!=a+""&&b(ko,document),typeof module!=a+""&&module.exports&&(module.exports=b)}();