// knockout.contextmenu v0.1.4
// Nicol√°s Escalante - nlante@gmail.com
// License: MIT

!function(a){"use strict";function b(b,c){function d(){f&&f.parentNode&&f.parentNode.removeChild(f),f=null}function e(a){for(var b=0;b<h.length;b++)if(h[b].element===a)return h[b]}var f,g=c.onclick,h=[];c.onclick=function(a){a.defaultPrevented||(g&&g(a),d())},b.bindingHandlers.contextMenu={getMenuFor:function(a,b){var c=e(a);return c?c.get(b):void 0},openMenuFor:function(a,b){var c=e(a);return c?c.open(b):void 0},init:function(e,g,i,j){function k(a){var b;return n=l(a),b=n.element,d(),a&&(b.style.top=a.pageY,b.style.left=a.pageX,a.preventDefault()),(c.body||c).appendChild(b),f=b,b}function l(){function a(a){var b=m(a),c=[];b.isVisible&&(e=e||b.isBoolean,b.isChecked&&c.push("checked"),b.isDisabled&&c.push("disabled"),b.isSeparator&&c.push("separator"),b.url&&c.push("with-url"),f.push('<li class="'+c.join(" ")+'">'+b.html+"</li>"),g.push(b.action)),h.push(b)}var d,e=!1,f=[],g=[],h=[];for(var i in o)a(i);return f.length&&(d=c.createElement("div"),d.className=q,d.innerHTML='<ul class="'+(e?"has-checks":"")+'">'+f.join("")+"</ul>",f.forEach(function(a,c){b.utils.registerEventHandler(d.children[0].children[c],"click",function(a){var b=g[c](j,a);!b&&a&&a.preventDefault()})})),{element:d,items:h,open:k,hide:function(){d&&d.parentNode&&d.parentNode.removeChild(d)}}}function m(c){function d(a,d){var e=c+" option must have an action or an url.";if(m)return!1;if(b.isObservable(g)&&"boolean"==typeof g())g(!g());else if("object"==typeof g){if(!(g.action||h||n))throw e;g.action&&(b.isObservable(g.action)&&"boolean"==typeof g.action()?g.action(!g.action()):g.action(a,d))}else{if("function"!=typeof g)throw e;g(a,d)}return!0}var e="",f="",g=o[c]||{},h=b.isObservable(g.url)?g.url():g.url,i=g.visible===a||null===g.visible||b.isObservable(g.visible)&&g.visible()||!!g.visible,j=!1,k=!g.disabled||b.isObservable(g.disabled)&&!g.disabled()||b.isObservable(g.enabled)&&g.enabled()||!!g.enabled,l=!1,m=!k,n=!!o[c].separator;return n||(e=b.isObservable(g.text)?g.text():g.text,e||(e=c),f=h?'<a href="'+h+'">'+e+"</a>":e),(b.isObservable(g)&&"boolean"==typeof g()||b.isObservable(g.action)&&"boolean"==typeof g.action())&&(l=!0,(g.action&&g.action()||"function"==typeof g&&g())&&(j=!0)),{html:f,text:e,url:h,isVisible:i,isChecked:j,isEnabled:k,isDisabled:m,isBoolean:l,isSeparator:n,action:d}}var n,o=g()||{},p=i(),q=p.contextMenuClass||"context-menu";p.bindMenuOnClick&&b.utils.registerEventHandler(e,"click",k),(p.bindMenuOnContextMenu===a||p.bindMenuOnContextMenu)&&b.utils.registerEventHandler(e,"contextmenu",k),h.push({element:e,get:function(){return n},open:k})}}}typeof ko!=a+""&&typeof document!=a+""&&b(ko,document),typeof module!=a+""&&module.exports&&(module.exports=b)}();